

package com.selsoft.pdftemplate;

import java.io.ByteArrayInputStream;
import java.io.File;
import java.io.FileInputStream;
import java.io.FileOutputStream;
import java.io.IOException;
import java.util.ArrayList;
import java.util.List;

import com.itextpdf.text.Chunk;
import com.itextpdf.text.Document;
import com.itextpdf.text.DocumentException;
import com.itextpdf.text.Element;
import com.itextpdf.text.ExceptionConverter;
import com.itextpdf.text.Paragraph;
import com.itextpdf.text.Phrase;
import com.itextpdf.text.Rectangle;
import com.itextpdf.text.Section;
import com.itextpdf.text.pdf.ColumnText;
import com.itextpdf.text.pdf.PdfPCell;
import com.itextpdf.text.pdf.PdfPTable;
import com.itextpdf.text.pdf.PdfWriter;
import com.itextpdf.text.pdf.draw.DottedLineSeparator;
import com.itextpdf.tool.xml.ElementList;
import com.itextpdf.tool.xml.XMLWorker;
import com.itextpdf.tool.xml.XMLWorkerHelper;
import com.itextpdf.tool.xml.css.CssFile;
import com.itextpdf.tool.xml.css.StyleAttrCSSResolver;
import com.itextpdf.tool.xml.html.Tags;
import com.itextpdf.tool.xml.parser.XMLParser;
import com.itextpdf.tool.xml.pipeline.css.CSSResolver;
import com.itextpdf.tool.xml.pipeline.css.CssResolverPipeline;
import com.itextpdf.tool.xml.pipeline.end.ElementHandlerPipeline;
import com.itextpdf.tool.xml.pipeline.html.HtmlPipeline;
import com.itextpdf.tool.xml.pipeline.html.HtmlPipelineContext;

public class PdfBilling {
	public static final String DEST = "C:/temp/biling.pdf";
	public static final String CSS = "table {border-collapse: collapse; width: 100%;}" + "tr { text-align: left; } "
			+ "th { color: white; background-color:  #2b3a76; padding: 2px; } "
			+ "td {font-size:15px; background-color: white;  padding: 2px; border-bottom: 1px solid #d7e8f9; }"
			+ "tr.balance td {background-color:  #d7e8f9;border-top: 1px solid #000;}" + ".nocss {}";

	// public static void main(String[] args) throws IOException,
	// DocumentException {
	// File file = new File(DEST);
	// file.getParentFile().mkdirs();
	// new PdfBilling().createPdf(DEST);
	// }

	private Object header;

	/**
	 * Creates a PDF with the given png file"
	 * 
	 * @param file
	 * @throws IOException
	 * @throws DocumentException
	 */
	public void createPdf(String file, List<Activity> activity) throws IOException, DocumentException {
		// step 1
		Document document = new Document();
		// step 2
		PdfWriter writer = PdfWriter.getInstance(document, new FileOutputStream(file));
		// step 3
		document.open();

		StringBuilder sb = new StringBuilder();
		sb.append("<div align=\"center\"><b>Rental Company</b></div>");
		PdfPTable table3 = getHeadTable();
		document.add(Chunk.NEWLINE);
		document.add(table3);

		// step 4
		document.add(getHead(new StringBuilder("<div><b>Account Activity</b></div>")));
		PdfPTable table = getTable(activity);
		PdfPTable table2 = getFootTable();

		document.add(table);
		document.add(Chunk.NEWLINE);
		document.add(Chunk.NEWLINE);

		Paragraph p = new Paragraph("Please detach the remittance slip below and return it with your payment.");
		DottedLineSeparator dottedline = new DottedLineSeparator();
		dottedline.setOffset(-2);
		dottedline.setGap(2f);
		p.add(dottedline);
		document.add(p);
		document.add(Chunk.NEWLINE);
		document.add(Chunk.NEWLINE);

		StringBuilder builder = new StringBuilder();
		builder.append("<div align=\"center\"><b>REMITANCE</b></div>");
		document.add(getHead(builder));
		document.add(table2);

		/*
		 * document.add(Chunk.NEWLINE); List<RentalPdf> rentalPdf=null;
		 * PdfPTable table4 = getRentalPdf(rentalPdf);
		 * 
		 */
		// step 5
		document.close();
	}

	public Element getHead(StringBuilder head) throws IOException {
		Element element = getElements(head);
		return element;
	}

	public PdfPTable getHeadTable() throws IOException {

		StringBuilder sb = new StringBuilder();
		sb.append("<table>");
		sb.append("<tr>");
		sb.append(
				"<th style=\"text-align: left;background-color:white;color:black;\" width=\"50%\">[Rental Company]:</th>");
		sb.append(
				"<th style=\"text-align: right;background-color:white;color:blue;\" width=\"90%\"><b>STATEMENT</b> </th>");
		sb.append("<th style=\"text-align: center;background-color:white;color:black;\" width=\"20%\"></th>");
		sb.append("</tr>");

		sb.append("<tr>");
		sb.append("<td style=\"text-align: left;border-bottom: 0px;\">");
		sb.append("[Street Address]");
		sb.append("</td>");
		sb.append("<td style=\"text-align: right;border-bottom: 0px;\">");
		sb.append("");
		sb.append("</td>");
		sb.append("<td style=\"text-align: center;border-bottom: 0px;\">");
		sb.append("");
		sb.append("</td>");
		sb.append("</tr>");

		sb.append("<tr>");
		sb.append("<td style=\"text-align: left;border-bottom: 0px;\">");
		sb.append("[City, ST ZIP]");
		sb.append("</td>");
		sb.append("<td style=\"text-align: right;border-bottom: 0px;\">");
		sb.append("Statement Date");
		sb.append("</td>");
		sb.append("<td style=\"text-align: center;border-bottom: 0px;border: 1px solid #000;\">");
		sb.append("04/30/2014");
		sb.append("</td>");
		sb.append("</tr>");

		sb.append("<tr>");
		sb.append("<td style=\"text-align: left;border-bottom: 0px;\">");
		sb.append("phone:000 000-0000");
		sb.append("</td>");
		sb.append("<td style=\"text-align: right;border-bottom: 0px;\">");
		sb.append("CUSTOMER ID");
		sb.append("</td>");
		sb.append("<td style=\"text-align: center;border-bottom: 0px;border: 1px solid #000;\">");
		sb.append("[ABC 123]");
		sb.append("</td>");
		sb.append("</tr>");

		sb.append("<tr>");
		sb.append("<td style=\"text-align: left;border-bottom: 0px;\">");
		sb.append("Bill To:[Customer Name]");
		sb.append("</td>");
		sb.append("<td style=\"text-align: right;border-bottom: 0px;\">");
		sb.append("property  [Street Address]");
		sb.append("</td>");
		sb.append("<td style=\"text-align: center;border-bottom: 0px;\">");
		sb.append(" ");
		sb.append("</td>");
		sb.append("</tr>");

		sb.append("<tr>");
		sb.append("<td style=\"text-align: left;border-bottom: 0px;\">");
		sb.append("[Street Address]");
		sb.append("</td>");
		sb.append("<td style=\"text-align: right;border-bottom: 0px;\">");
		sb.append("City, [ST ZIP");
		sb.append("</td>");
		sb.append("<td style=\"text-align: center;border-bottom: 0px;\">");
		sb.append("  ");
		sb.append("</td>");
		sb.append("</tr>");

		sb.append("<tr>");
		sb.append("<td style=\"text-align: left;border-bottom: 0px;\" >");
		sb.append("City, [ST ZIP]");
		sb.append("</td>");
		sb.append("<td style=\"text-align: right;border-bottom: 0px;\">");
		sb.append("Contract From     1-Feb-2014");
		sb.append("</td>");
		sb.append("<td style=\"text-align: center;border-bottom: 0px;\">");
		sb.append("  ");
		sb.append("</td>");
		sb.append("</tr>");

		sb.append("<tr>");
		sb.append("<td style=\"text-align: left;border-bottom: 0px;\">");
		sb.append("[phone]");
		sb.append("</td>");
		sb.append("<td style=\"text-align: right;border-bottom: 0px;\">");
		sb.append(" To       31-Jan-2015");
		sb.append("</td>");

		// sb.append("<td >");
		sb.append("   ");
		// sb.append("</td>");
		sb.append("</tr>");

		sb.append("</table>");

		return (PdfPTable) getElements(sb);

	}

	public PdfPTable getTable(List<Activity> activity) throws IOException {

		StringBuilder sb = new StringBuilder();
		sb.append("<table>");
		sb.append("<tr>");
		sb.append("<th style=\"text-align: center;\" width=\"20%\">DATE</th>");
		sb.append("<th style=\"text-align: center;\" width=\"15%\">REF</th>");
		sb.append("<th width=\"45%\">DESCRIPTION</th>");
		sb.append("<th width=\"20%\">AMOUNT</th>");
		sb.append("</tr>");

		for (Activity act : activity) {
			sb.append("<tr>");
			sb.append("<td style=\"text-align: center;\">");
			sb.append(act.getDate());
			sb.append("</td>");
			sb.append("<td style=\"text-align: center;\">");
			sb.append(act.getRef());
			sb.append("</td>");
			sb.append("<td>");
			sb.append(act.getDesc());
			sb.append("</td>");
			sb.append("<td style=\"text-align: right;\">");
			sb.append(act.getAmount());
			sb.append("</td>");
			sb.append("</tr>");

		}

		for (int i = 0; i < 10;) {
			i++;
			sb.append("<tr>");
			sb.append("<td style=\"text-align: center;\">");
			sb.append(" -- ");
			sb.append("</td>");
			sb.append("<td style=\"text-align: center;\">");
			sb.append(" -- ");
			sb.append("</td>");
			sb.append("<td>");
			sb.append(" -- ");
			sb.append("</td>");
			sb.append("<td style=\"text-align: right;\">");
			sb.append(" -- ");
			sb.append("</td>");
			sb.append("</tr>");
		}

		sb.append("<tr class=\"balance\">");
		sb.append("<td>");
		sb.append("</td>");
		sb.append("<td>");
		sb.append("</td>");
		sb.append("<td style=\"text-align: right;\">");
		sb.append("<b>BALANCE DUE</b>");
		sb.append("</td>");
		sb.append("<td border=\"1\" style=\"background-color: #a4cef7;text-align: right;\">");
		sb.append("$ 1,020.993");
		sb.append("</td>");
		sb.append("</tr>");

		sb.append("</table>");

		return (PdfPTable) getElements(sb);

	}

	public PdfPTable getFootTable() throws IOException {

		StringBuilder sb = new StringBuilder();
		sb.append("<table>");
		sb.append("<tr>");
		sb.append(
				"<th style=\"text-align: left;background-color:white;color:black;\" width=\"60%\">Please make Check Payable to [Name] and mail to:</th>");
		sb.append(
				"<th style=\"text-align: right;background-color:white;color:black;\" width=\"30%\"> STATEMENT DATE</th>");
		sb.append("<th style=\"text-align: center;background-color:white;color:black;\" width=\"20%\">04/30/2014</th>");
		sb.append("</tr>");

		sb.append("<tr>");
		sb.append("<td style=\"text-align: left;border-bottom: 0px;\">");
		sb.append("[Company Name]");
		sb.append("</td>");
		sb.append("<td style=\"text-align: right;border-bottom: 0px;\">");
		sb.append("CUSTOMER ID");
		sb.append("</td>");
		sb.append("<td style=\"text-align: center;border-bottom: 0px;\">");
		sb.append("[ABC123]");
		sb.append("</td>");
		sb.append("</tr>");

		sb.append("<tr>");
		sb.append("<td style=\"text-align: left;border-bottom: 0px;\">");
		sb.append("[Street Address]");
		sb.append("</td>");
		sb.append("<td style=\"text-align: right;border-bottom: 0px;\">");
		sb.append("");
		sb.append("</td>");
		sb.append("<td style=\"text-align: center;border-bottom: 0px;\">");
		sb.append("");
		sb.append("</td>");
		sb.append("</tr>");

		sb.append("<tr>");
		sb.append("<td style=\"text-align: left;border-bottom: 0px;\">");
		sb.append("[City, ST, ZIP]");
		sb.append("</td>");
		sb.append("<td style=\"text-align: right;border-bottom: 0px;\">");
		sb.append("DUE DATE");
		sb.append("</td>");
		sb.append("<td style=\"text-align: center;border-bottom: 0px;border: 1px solid #000;\">");
		sb.append("05/30/2014");
		sb.append("</td>");
		sb.append("</tr>");

		sb.append("<tr>");
		sb.append("<td style=\"text-align: left;border-bottom: 0px;\">");
		sb.append("");
		sb.append("</td>");
		sb.append("<td style=\"text-align: right;border-bottom: 0px;\">");
		sb.append("BALANCE DUE");
		sb.append("</td>");
		sb.append("<td style=\"text-align: center;border-bottom: 0px;border: 1px solid #000;\">");
		sb.append("$ 1,020.00");
		sb.append("</td>");
		sb.append("</tr>");

		sb.append("<tr>");
		sb.append("<td style=\"text-align: left;border-bottom: 0px;\">");
		sb.append("-");
		sb.append("</td>");
		sb.append("<td style=\"text-align: right;border-bottom: 0px;\">");
		sb.append("-");
		sb.append("</td>");
		sb.append("<td style=\"text-align: center;border-bottom: 0px;\">");
		sb.append(" ");
		sb.append("</td>");
		sb.append("</tr>");

		sb.append("<tr>");
		sb.append("<td style=\"text-align: left;border-bottom: 0px;\">");
		sb.append("Please write Customer ID on your check.");
		sb.append("</td>");
		sb.append("<td style=\"text-align: right;border-bottom: 0px;\">");
		sb.append("AMMOUNT ENCLOSED");
		sb.append("</td>");
		sb.append("<td style=\"text-align: center;border-bottom: 0px;border: 1px solid #000;\">");
		sb.append("  ");
		sb.append("</td>");
		sb.append("</tr>");

		sb.append("</table>");

		return (PdfPTable) getElements(sb);
	}

	public Element getElements(StringBuilder sb) throws IOException {
		CSSResolver cssResolver = new StyleAttrCSSResolver();
		CssFile cssFile = XMLWorkerHelper.getCSS(new ByteArrayInputStream(CSS.getBytes()));
		cssResolver.addCss(cssFile);

		// HTML
		HtmlPipelineContext htmlContext = new HtmlPipelineContext(null);
		htmlContext.setTagFactory(Tags.getHtmlTagProcessorFactory());

		// Pipelines
		ElementList elements = new ElementList();
		ElementHandlerPipeline pdf = new ElementHandlerPipeline(elements, null);
		HtmlPipeline html = new HtmlPipeline(htmlContext, pdf);
		CssResolverPipeline css = new CssResolverPipeline(cssResolver, html);

		// XML Worker
		XMLWorker worker = new XMLWorker(css, true);
		XMLParser p = new XMLParser(worker);
		p.parse(new ByteArrayInputStream(sb.toString().getBytes()));

		return elements.get(0);

	}

	public PdfPTable getRenatlPdf(List<RentalPdf> rentalPdf) throws IOException {
		StringBuilder sb = new StringBuilder();
		sb.append("<table>");
		Customer customer = new Customer("Sudhansu Sekhar", "ABC999", "192/CC", "CHENAI", "TN", "232333", "9499493933");
		List<Customer> custList = new ArrayList();
		custList.add(customer);
		for (Customer cust : custList) {
			sb.append(cust.getId());
			sb.append(cust.getName());
			sb.append(cust.getAddress());
			sb.append(cust.getCity());
			sb.append(cust.getState());
			sb.append(cust.getZip());
			sb.append(cust.getPhone());
		}

		Properties properties = new Properties("33io3/dd", "HYDER", "TS", "4940940", "10/06/2017", "25/10/2090");
		List<Properties> propList = new ArrayList();
		propList.add(properties);
		for (Properties props : propList) {
			sb.append(props.getAddress());
			sb.append(props.getCity());
			sb.append(props.getState());
			sb.append(props.getZip());
			sb.append(props.getContractFrom());
			sb.append(props.getContractTo());
		}

		RentalCompany rentalCompany = new RentalCompany("303", "Suite 110", "Allen", "Tx75002", "114121");
		List<RentalCompany> rentCompList = new ArrayList();
		rentCompList.add(rentalCompany);

		for (RentalCompany rt : rentCompList) {
			sb.append(rt.getStreetAddress());
			sb.append(rt.getCity());
			sb.append(rt.getState());
			sb.append(rt.getZip());

		}

		Company company = new Company("301", "Site 111", "Houstan", "USA", "HO7511");

		List<Company> compList = new ArrayList();
		compList.add(company);

		for (Company cmp : compList) {
			sb.append(cmp.getCompanyName());
			sb.append(cmp.getStreetAddress());
			sb.append(cmp.getCity());
			sb.append(cmp.getState());
			sb.append(cmp.getZip());

		}

		Statement st = new Statement("11/10/2017");
		List<Statement> stList = new ArrayList();
		stList.add(st);
		for (Statement s : stList) {
			sb.append(s.getStatementDate());
		}

		return (PdfPTable) getElements(sb);

	}
	
}
